<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examples for ingestr • ingestr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Examples for ingestr">
<meta property="og:description" content="ingestr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ingestr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example.html">Examples for ingestr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stineb/ingestr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Examples for ingestr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stineb/ingestr/blob/master/vignettes/example.Rmd"><code>vignettes/example.Rmd</code></a></small>
      <div class="hidden name"><code>example.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The package <code>ingestr</code> provides functions to extract (ingest) point data (given longitude, latitude, and required dates) from large global files or remote data servers and create time series at user-specified temporal resolution. This can be done for a set of sites at once, given a data frame containing the meta info for each site (see data frame <code>siteinfo</code>, with columns <code>lon</code> for longitude, <code>lat</code> for latitude, <code>date_start</code> and <code>date_end</code> specifying required dates). The output for such a set of site-level data is a nested data frame with rows for each site and columns <code>lon</code>, <code>lat</code>, <code>date_start</code>, and <code>date_end</code> plus an added column where the time series of ingested data is nested inside.</p>
<p>Data can be ingested for different data types (argument <code>source</code> in several functions), each dealing with a specific format of the original data and specific functions to read from respective files or remote servers. The following data types can be handled currently (more to be added by you if you like):</p>
<p>Meteo data:</p>
<ul>
<li>
<a href="https://fluxnet.fluxdata.org/data/fluxnet2015-dataset/">FLUXNET</a>: <code>source = "fluxnet"</code>, also flux data can be read in, reading from files</li>
<li>
<a href="http://www.eu-watch.org/data_availability">WATCH-WFDEI</a>: <code>source = "watch_wfdei"</code>, reading from files</li>
<li>
<a href="https://crudata.uea.ac.uk/cru/data/hrg/">CRU</a>: <code>source = "cru"</code>, reading from files</li>
</ul>
<p>Data on Google Earth Engine: <code>source = "gee"</code>, using Koen Hufken’s <a href="https://khufkens.github.io/gee_subset/">gee_suset</a> library):</p>
<ul>
<li>MODIS FPAR</li>
<li>MODIS EVI</li>
<li>MODIS GPP</li>
</ul>
<p>Elevation data:</p>
<ul>
<li>
<a href="https://www.ngdc.noaa.gov/mgg/global/">ETOPO1</a>: <code>source = "etopo1"</code>, reading from files</li>
</ul>
<p>MODIS data (not yet implemented):</p>
<ul>
<li>
<a href="https://docs.ropensci.org/MODISTools/">MODISTools</a> R package to access data on remote server ORNL DAAC (not yet implemented).</li>
</ul>
<p>Examples to read data for a single site for each data type are given in Section ‘Examples for a single site’. Handling ingestion for multiple sites is descrbed in Section ‘Example for a set of sites’.</p>
<p><strong>Note</strong> that this package does not provide the original data. Please follow links to data sources above and cite original references when using this data.</p>
<div id="variable-names-and-units" class="section level3">
<h3 class="hasAnchor">
<a href="#variable-names-and-units" class="anchor"></a>Variable names and units</h3>
<p>All ingested data follows standardised variable naming and (optionally) units.</p>
<table class="table">
<thead><tr class="header">
<th>Variable</th>
<th>Variable name</th>
<th>Units</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Gross primary production</td>
<td><code>gpp</code></td>
<td>g CO<span class="math inline">\(^{-2}\)</span> m<span class="math inline">\(^{-2}\)</span> X<span class="math inline">\(^{-1}\)</span>
</td>
</tr>
<tr class="even">
<td>Air temperature</td>
<td><code>temp</code></td>
<td>
<span class="math inline">\(^\circ\)</span>C</td>
</tr>
<tr class="odd">
<td>Precipitation</td>
<td><code>prec</code></td>
<td>mm X<span class="math inline">\(^{-1}\)</span>
</td>
</tr>
<tr class="even">
<td>Vapour pressure deficit</td>
<td><code>vpd</code></td>
<td>Pa</td>
</tr>
<tr class="odd">
<td>Atmospheric pressure</td>
<td><code>patm</code></td>
<td>Pa</td>
</tr>
<tr class="even">
<td>Net radiation</td>
<td><code>netrad</code></td>
<td>J m<span class="math inline">\(^{-2}\)</span> X<span class="math inline">\(^{-1}\)</span>
</td>
</tr>
<tr class="odd">
<td>Photosynthetic photon flux density</td>
<td><code>ppfd</code></td>
<td>mol m<span class="math inline">\(^{-2}\)</span> X<span class="math inline">\(^{-1}\)</span>
</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(X\)</span> stands for ‘s’ for half-hourly and hourly, ‘d’ for daily, ‘m’ for monthly, and ‘y’ for annual data.</p>
<p>Use these variable names for specifying which variable names they correspond to in the original data source (see argument <code>getvars</code> to functions <code><a href="../reference/ingest.html">ingest()</a></code> and <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code>).</p>
</div>
</div>
<div id="examples-for-a-single-site" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-for-a-single-site" class="anchor"></a>Examples for a single site</h2>
<p>The function <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> can be used to ingest data for a single site. The argument <code>source</code> specifies which data type (source) is to be read from and triggers the use of specific wrapper functions that are designed to read from files whith formats that differ between sources. Source-specific settings for data processing can be provided by argument <code>settings</code> (described for each data source below). More info about other, source-independent arguments are available through the man page (see <code><a href="../reference/ingest_bysite.html">?ingest_bysite</a></code>).</p>
<div id="fluxnet" class="section level3">
<h3 class="hasAnchor">
<a href="#fluxnet" class="anchor"></a>FLUXNET</h3>
<div id="meteo-data" class="section level4">
<h4 class="hasAnchor">
<a href="#meteo-data" class="anchor"></a>Meteo data</h4>
<p>Reading from FLUXNET files offers multiple settings to be used specified by the user. Here, we’re specifying that no soil water content data is read (<code>getswc = FALSE</code> in <code>settings_fluxnet</code>, passed to <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> through argument <code>settings</code>), and that half-hourly data is stored in a separate directory. The latter specification is used to derive daytime VPD which is not given in FLUXNET data, but required here (see <code>getvars</code> element <code>vpd  = "VPD_F_DAY"</code>).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">settings_fluxnet</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">dir_hh</span> <span class="kw">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/HH/"</span>,
  <span class="kw">getswc</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">df_fluxnet</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="kw">sitename</span> <span class="kw">=</span> <span class="st">"CH-Lae"</span>,
  <span class="kw">source</span> <span class="kw">=</span> <span class="st">"fluxnet"</span>,
  <span class="kw">getvars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="st">"TA_F_DAY"</span>,
                 <span class="kw">prec</span> <span class="kw">=</span> <span class="st">"P_F"</span>,
                 <span class="kw">vpd</span>  <span class="kw">=</span> <span class="st">"VPD_F_DAY"</span>,
                 <span class="kw">ppfd</span> <span class="kw">=</span>  <span class="st">"SW_IN_F"</span>,
                 <span class="kw">netrad</span> <span class="kw">=</span> <span class="st">"NETRAD"</span>,
                 <span class="kw">patm</span> <span class="kw">=</span> <span class="st">"PA_F"</span>),
  <span class="kw">dir</span> <span class="kw">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/DD/"</span>,
  <span class="kw">settings</span> <span class="kw">=</span> <span class="no">settings_fluxnet</span>,
  <span class="kw">timescale</span> <span class="kw">=</span> <span class="st">"d"</span>,
  <span class="kw">year_start</span> <span class="kw">=</span> <span class="fl">2010</span>,
  <span class="kw">year_end</span> <span class="kw">=</span> <span class="fl">2012</span>,
  <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  )</pre></body></html></div>
<pre><code>## Warning: Unknown columns: ``</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_fluxnet</span></pre></body></html></div>
<pre><code>## # A tibble: 1,095 x 8
##    date        temp  prec    vpd   ppfd netrad  patm sitename
##    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
##  1 2010-01-01  1.50 4.62    7.81  4.12      NA 91032 CH-Lae  
##  2 2010-01-02 -5.10 3.04   49.0  10.1       NA 92928 CH-Lae  
##  3 2010-01-03 -5.22 0.001 133.   14.0       NA 93320 CH-Lae  
##  4 2010-01-04 -5.94 0      92.3  13.5       NA 92687 CH-Lae  
##  5 2010-01-05 -7.96 0      27.3   6.80      NA 91863 CH-Lae  
##  6 2010-01-06 -6.33 1.11    9.04  2.45      NA 91607 CH-Lae  
##  7 2010-01-07 -3.77 0.091  44.8  10.8       NA 92168 CH-Lae  
##  8 2010-01-08 -5.78 3.79   10.1   1.21      NA 92003 CH-Lae  
##  9 2010-01-09 -8.32 2.38   16.6   0.872     NA 91824 CH-Lae  
## 10 2010-01-10 -7.78 0.724  32.1   2.82      NA 92482 CH-Lae  
## # … with 1,085 more rows</code></pre>
<p>Note that the argument <code>getvars</code> as specified above triggers the ingestion of the six variables <code>"TA_F_DAY", "P_F", "VPD_F_DAY",  "SW_IN_F", "NETRAD", "PA_F"</code> and their renaming to <code>"temp", "prec", "vpd", "ppfd", "netrad", "patm"</code>, respecitvely. Any name can be used for renaming.</p>
</div>
<div id="flux-data" class="section level4">
<h4 class="hasAnchor">
<a href="#flux-data" class="anchor"></a>Flux data</h4>
<p>The same function can also be used to read in other FLUXNET variables (e.g., CO2 flux data) and conduct data filtering steps. Here, we’re reading daily GPP and uncertainty (standard error), based on the nighttime flux decomposition method (<code>"GPP_NT_VUT_REF"</code> and <code>"GPP_NT_VUT_SE"</code> in argument <code>getvars</code>). The <code>settings</code> argument can be used again to specify settings that are specific to the <code>"fluxnet"</code> data source. Here, we keep only data where at least 80% is based on non-gapfilled half-hourly data (<code>threshold_GPP = 0.8</code>), and where the daytime and nighttime-based estimates are consistent, that is, where their difference is below the the 97.5% and above the 2.5% quantile (<code>filter_ntdt = TRUE</code>). Negative GPP values are not removed (<code>remove_neg = FALSE</code>).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">settings_fluxnet</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">dir_hh</span>       <span class="kw">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/HH/"</span>,
  <span class="kw">getswc</span>       <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">filter_ntdt</span>  <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">threshold_GPP</span><span class="kw">=</span> <span class="fl">0.8</span>,
  <span class="kw">remove_neg</span>   <span class="kw">=</span> <span class="fl">FALSE</span>
  )

<span class="no">ddf_fluxnet</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="kw">sitename</span>  <span class="kw">=</span> <span class="st">"CH-Lae"</span>,
  <span class="kw">source</span>    <span class="kw">=</span> <span class="st">"fluxnet"</span>,
  <span class="kw">getvars</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="kw">gpp</span> <span class="kw">=</span> <span class="st">"GPP_NT_VUT_REF"</span>,
                    <span class="kw">gpp_unc</span>   <span class="kw">=</span> <span class="st">"GPP_NT_VUT_SE"</span>),
  <span class="kw">dir</span>       <span class="kw">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/DD/"</span>,
  <span class="kw">settings</span>  <span class="kw">=</span> <span class="no">settings_fluxnet</span>,
  <span class="kw">timescale</span> <span class="kw">=</span> <span class="st">"d"</span>,
  <span class="kw">year_start</span><span class="kw">=</span> <span class="fl">2010</span>,
  <span class="kw">year_end</span>  <span class="kw">=</span> <span class="fl">2012</span>
  )</pre></body></html></div>
</div>
<div id="settings" class="section level4">
<h4 class="hasAnchor">
<a href="#settings" class="anchor"></a>Settings</h4>
<p>The argument <code>settings</code> in functions <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> and <code><a href="../reference/ingest.html">ingest()</a></code> is used to pass settings that are specific to the data source (argument <code>source</code>) with which the functions are used. Default settings are specified for each data source. For <code>source = "fluxnet"</code>, defaults are returned by a function call of <code><a href="../reference/get_settings_fluxnet.html">get_settings_fluxnet()</a></code> and are described in the function’s man page (see <code><a href="../reference/get_settings_fluxnet.html">?get_settings_fluxnet</a></code>). Defaults are used for settings elements that are not specified by the user.</p>
</div>
</div>
<div id="watch-wfdei" class="section level3">
<h3 class="hasAnchor">
<a href="#watch-wfdei" class="anchor"></a>WATCH-WFDEI</h3>
<p>Let’s extract data for the location corresponding to FLUXNET site ‘CH-Lae’ (lon = 8.365, lat = 47.4781). This extracts from original WATCH-WFDEI files, provided as NetCDF (global, 0.5 degree resolution), provided as monthly files containing all days in each month. The data directory specified here (<code>dir = "~/data/watch_wfdei/"</code>) contains subdirectories with names containing the variable names (corresponding to the ones specified by the argument <code>getvars = list(temp = "Tair")</code>).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_watch</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="kw">sitename</span>  <span class="kw">=</span> <span class="st">"CH-Lae"</span>,
  <span class="kw">source</span>    <span class="kw">=</span> <span class="st">"watch_wfdei"</span>,
  <span class="kw">getvars</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="st">"Tair"</span>),
  <span class="kw">dir</span>       <span class="kw">=</span> <span class="st">"~/data/watch_wfdei/"</span>,
  <span class="kw">timescale</span> <span class="kw">=</span> <span class="st">"d"</span>,
  <span class="kw">year_start</span><span class="kw">=</span> <span class="fl">2010</span>,
  <span class="kw">year_end</span>  <span class="kw">=</span> <span class="fl">2012</span>,
  <span class="kw">lon</span>       <span class="kw">=</span> <span class="fl">8.365</span>,
  <span class="kw">lat</span>       <span class="kw">=</span> <span class="fl">47.4781</span>,
  <span class="kw">verbose</span>   <span class="kw">=</span> <span class="fl">FALSE</span>
  )</pre></body></html></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_watch</span></pre></body></html></div>
</div>
<div id="cru-ts" class="section level3">
<h3 class="hasAnchor">
<a href="#cru-ts" class="anchor"></a>CRU TS</h3>
<p>As above, let’s extract CRU data for the location corresponding to FLUXNET site ‘CH-Lae’ (lon = 8.365, lat = 47.4781). Note that we’re using <code>tmx</code> (the daily maximum temperature). This extracts monthly data from the CRU TS data. Interpolation to daily values is done using a wather generator for daily precipitation (given monthly total precipitation and number of wet days in each month), and a polynomial that conserves monthly means for all other variables.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_cru</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="kw">sitename</span>  <span class="kw">=</span> <span class="st">"CH-Lae"</span>,
  <span class="kw">source</span>    <span class="kw">=</span> <span class="st">"cru"</span>,
  <span class="kw">getvars</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="st">"tmx"</span>),
  <span class="kw">dir</span>       <span class="kw">=</span> <span class="st">"~/data/cru/ts_4.01/"</span>,
  <span class="kw">timescale</span> <span class="kw">=</span> <span class="st">"d"</span>,
  <span class="kw">year_start</span><span class="kw">=</span> <span class="fl">2010</span>,
  <span class="kw">year_end</span>  <span class="kw">=</span> <span class="fl">2012</span>,
  <span class="kw">lon</span>       <span class="kw">=</span> <span class="fl">8.365</span>,
  <span class="kw">lat</span>       <span class="kw">=</span> <span class="fl">47.4781</span>,
  <span class="kw">verbose</span>   <span class="kw">=</span> <span class="fl">FALSE</span>
  )</pre></body></html></div>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmx
## If that is not correct, you can set it to one of: tmx, stn</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_cru</span></pre></body></html></div>
<pre><code>## # A tibble: 1,095 x 3
##    date          temp sitename
##    &lt;date&gt;       &lt;dbl&gt; &lt;chr&gt;   
##  1 2010-01-01  0.511  CH-Lae  
##  2 2010-01-02  0.343  CH-Lae  
##  3 2010-01-03  0.189  CH-Lae  
##  4 2010-01-04  0.0493 CH-Lae  
##  5 2010-01-05 -0.0769 CH-Lae  
##  6 2010-01-06 -0.189  CH-Lae  
##  7 2010-01-07 -0.288  CH-Lae  
##  8 2010-01-08 -0.373  CH-Lae  
##  9 2010-01-09 -0.444  CH-Lae  
## 10 2010-01-10 -0.501  CH-Lae  
## # … with 1,085 more rows</code></pre>
<p>We can compare the temperature recorded at the site and the temperature data extracted from WATCH-WFDEI.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="no">df_fluxnet</span> <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">temp_fluxnet</span> <span class="kw">=</span> <span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="fu">rename</span>(<span class="no">df_watch</span>, <span class="kw">temp_watch</span> <span class="kw">=</span> <span class="no">temp</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sitename"</span>, <span class="st">"date"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="fu">rename</span>(<span class="no">df_cru</span>, <span class="kw">temp_cru</span> <span class="kw">=</span> <span class="no">temp</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sitename"</span>, <span class="st">"date"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">temp_fluxnet</span>, <span class="no">temp_watch</span>, <span class="no">temp_cru</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"source"</span>, <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"temp"</span>, <span class="kw">names_prefix</span> <span class="kw">=</span> <span class="st">"temp_"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="no">df</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">date</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">source</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</pre></body></html></div>
<p><img src="example_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Looks sweet.</p>
</div>
<div id="google-earth-engine" class="section level3">
<h3 class="hasAnchor">
<a href="#google-earth-engine" class="anchor"></a>Google Earth Engine</h3>
<p>The library <code>gee_subset</code> by Koen Hufkens can be downloaded from this <a href="https://khufkens.github.io/gee_subset/">link</a> and used to extract data directly from Google Earth Engine. Note that this requires the following programmes to be available:</p>
<ul>
<li>git: You can use <a href="https://brew.sh/">Homebrew</a> to installing git by entering in your terminal: <code>brew install git</code>.</li>
<li><a href="https://www.python.org/">python</a></li>
</ul>
<p>Then, carry out the follwing steps:</p>
<ul>
<li>In your terminal, change to where you want to have the repository. In this example, we’re cloning it into our home directory:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="bu">cd</span> ~
<span class="fu">git</span> clone https://github.com/khufkens/google_earth_engine_subsets.git</code></pre></div>
<p>To get access to using the Google Earth Engine API (required to use the <code>gee_subset</code> library), carry out the following steps in your terminal. This follows steps described <a href="https://github.com/google/earthengine-api/issues/27">here</a>.</p>
<ol style="list-style-type: decimal">
<li>Install google API Python client</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> pip install --upgrade google-api-python-client</code></pre></div>
<p>I had an error and first had to do this here following <a href="https://github.com/pypa/pip/issues/3165">this link</a>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> pip install --ignore-installed six</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Install pyCrypto</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> pip install pyCrypto --upgrade</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Install Python GEE API</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> pip install earthengine-api</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Run authentification for GEE</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">earthengine</span> authenticate</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Finally, try if it works. This shouldn’t return an error:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">python</span> -c <span class="st">"import ee; ee.Initialize()"</span></code></pre></div>
<div id="modis-fpar" class="section level4">
<h4 class="hasAnchor">
<a href="#modis-fpar" class="anchor"></a>MODIS FPAR</h4>
<p>To facilitate the selection of data products and bands to be downloaded, you may use the function <code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code> which defines defaults for different data bundles (<code><a href="https://rdrr.io/r/base/c.html">c("modis_fpar", "modis_evi", "modis_lai", "modis_gpp")</a></code> are available).</p>
<ul>
<li>
<code>"modis_fpar"</code>: MODIS/006/MCD15A3H, band Fpar</li>
<li>
<code>"modis_evi"</code>: MODIS/006/MOD13Q1, band EVI</li>
<li>
<code>"modis_lai"</code>: MOD15A2, band <code>Lai_1km</code>
</li>
<li>
<code>"modis_gpp"</code>: MODIS/006/MOD17A2H, band Gpp</li>
</ul>
<p>The following example is for downloading MODIS FPAR data.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">settings_gee</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_settings_gee.html">get_settings_gee</a></span>(
  <span class="kw">bundle</span>            <span class="kw">=</span> <span class="st">"modis_fpar"</span>,
  <span class="kw">python_path</span>       <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span>(<span class="st">"which python"</span>, <span class="kw">intern</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">gee_path</span>          <span class="kw">=</span> <span class="st">"~/google_earth_engine_subsets/gee_subset/"</span>,
  <span class="kw">data_path</span>         <span class="kw">=</span> <span class="st">"~/data/gee_subsets/"</span>,
  <span class="kw">method_interpol</span>   <span class="kw">=</span> <span class="st">"linear"</span>,
  <span class="kw">keep</span>              <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">overwrite_raw</span>     <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">overwrite_interpol</span><span class="kw">=</span> <span class="fl">TRUE</span>
  )</pre></body></html></div>
<p>This can now be used to download the data to the directory specified by argument <code>data_path</code> of function <code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_gee_modis_fpar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="kw">sitename</span>  <span class="kw">=</span> <span class="st">"CH-Lae"</span>,
  <span class="kw">source</span>    <span class="kw">=</span> <span class="st">"gee"</span>,
  <span class="kw">year_start</span><span class="kw">=</span> <span class="fl">2010</span>,
  <span class="kw">year_end</span>  <span class="kw">=</span> <span class="fl">2012</span>,
  <span class="kw">lon</span>       <span class="kw">=</span> <span class="fl">8.365</span>,
  <span class="kw">lat</span>       <span class="kw">=</span> <span class="fl">47.4781</span>,
  <span class="kw">settings</span>  <span class="kw">=</span> <span class="no">settings_gee</span>,
  <span class="kw">verbose</span>   <span class="kw">=</span> <span class="fl">FALSE</span>
  )</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_character(),
##   longitude = col_double(),
##   latitude = col_double(),
##   date = col_date(format = ""),
##   Fpar = col_double(),
##   FparLai_QC = col_double(),
##   product = col_character()
## )</code></pre>
<pre><code>## loess...</code></pre>
<pre><code>## done.</code></pre>
<pre><code>## spline...</code></pre>
<pre><code>## done.</code></pre>
<pre><code>## linear ...</code></pre>
<pre><code>## done.</code></pre>
<pre><code>## sgfilter ...</code></pre>
<pre><code>## done.</code></pre>
<pre><code>## Warning: Filling values with last available data point at head</code></pre>
<pre><code>## Warning: Filling values with last available data point at tail.</code></pre>
<p>Plot this data.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_fapar_ingestr_bysite.html">plot_fapar_ingestr_bysite</a></span>(<span class="no">df_gee_modis_fpar</span>, <span class="no">settings_gee</span>)</pre></body></html></div>
<pre><code>## Warning: Removed 815 rows containing missing values (geom_point).

## Warning: Removed 815 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 895 rows containing missing values (geom_point).</code></pre>
<p><img src="example_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
</div>
<div id="co2" class="section level3">
<h3 class="hasAnchor">
<a href="#co2" class="anchor"></a>CO2</h3>
<p>Ingesting CO2 data is particularly simple. We can safely assume it’s well mixed in the atmosphere (independent of site location), and we can use a annual mean value for all days in respective years.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_co2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="kw">sitename</span>  <span class="kw">=</span> <span class="st">"CH-Lae"</span>,
  <span class="kw">source</span>    <span class="kw">=</span> <span class="st">"co2"</span>,
  <span class="kw">year_start</span><span class="kw">=</span> <span class="fl">2010</span>,
  <span class="kw">year_end</span>  <span class="kw">=</span> <span class="fl">2012</span>,
  <span class="kw">verbose</span>   <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">settings</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">path</span> <span class="kw">=</span> <span class="st">"~/data/co2/cCO2_rcp85_const850-1765.csv"</span>)
  )</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   year = col_double(),
##   co2 = col_double()
## )</code></pre>
</div>
</div>
<div id="examples-for-a-site-ensemble" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-for-a-site-ensemble" class="anchor"></a>Examples for a site ensemble</h2>
<p>To collect data from an ensemble of sites, we have to define a meta data frame, here called <code>siteinfo</code>, with rows for each site and columns <code>lon</code> for longitude, <code>lat</code> for latitude, <code>date_start</code> and <code>date_end</code> for required dates (Dates are objects returned by a <code><a href="http://lubridate.tidyverse.org/reference/ymd.html">lubridate::ymd()</a></code> function call - this stands for year-month-day). The function <code><a href="../reference/ingest.html">ingest()</a></code> can then be used to collect all site-level data as a nested data frame corresponding to the metadata <code>siteinfo</code> with an added column named <code>data</code> where the time series of ingested data is nested inside.</p>
<p>Note that extracting for an ensemble of sites at once is more efficient for data types that are global files (WATCH-WFDEI, and CRU). In this case, the <code>raster</code> package can be used to efficiently ingest data.</p>
<p>First, define a list of sites and get site meta information. The required meta information is provided in file <code>siteinfo_fluxnet2015.csv</code>. This file is created as described in (and using code from) <a href="https://github.com/stineb/metainfo_fluxnet2015">metainfo_fluxnet2015</a>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">mysites</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"BE-Vie"</span>, <span class="st">"DE-Tha"</span>, <span class="st">"DK-Sor"</span>, <span class="st">"FI-Hyy"</span>, <span class="st">"IT-Col"</span>, <span class="st">"NL-Loo"</span>, <span class="st">"US-MMS"</span>, <span class="st">"US-WCr"</span>, <span class="st">"US-UMB"</span>, <span class="st">"US-Syv"</span>, <span class="st">"DE-Hai"</span>)

<span class="no">siteinfo</span> <span class="kw">&lt;-</span> <span class="kw pkg">readr</span><span class="kw ns">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>(<span class="st">"~/ingestr/siteinfo_fluxnet2015.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">sitename</span> <span class="kw">%in%</span> <span class="no">mysites</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">date_start</span> <span class="kw">=</span> <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">year_start</span>, <span class="st">"-01-01"</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">date_end</span> <span class="kw">=</span> <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">year_end</span>, <span class="st">"-12-31"</span>)))</pre></body></html></div>
<p>This file looks like this:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">siteinfo</span>)</pre></body></html></div>
<pre><code>## # A tibble: 11 x 14
##    sitename    lon   lat   elv year_start year_end classid c4      whc
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;lgl&gt; &lt;dbl&gt;
##  1 BE-Vie     6.00  50.3   493       1996     2014 MF      FALSE 313. 
##  2 DE-Hai    10.5   51.1   430       2000     2012 DBF     FALSE 283. 
##  3 DE-Tha    13.6   51.0   380       1996     2014 ENF     FALSE 296. 
##  4 DK-Sor    11.6   55.5    40       1996     2014 DBF     FALSE 226. 
##  5 FI-Hyy    24.3   61.8   181       1996     2014 ENF     FALSE 255. 
##  6 IT-Col    13.6   41.8  1560       1996     2014 DBF     FALSE 268. 
##  7 NL-Loo     5.74  52.2    25       1996     2013 ENF     FALSE  71.1
##  8 US-MMS   -86.4   39.3   275       1999     2014 DBF     FALSE 343. 
##  9 US-Syv   -89.3   46.2   540       2001     2014 MF      FALSE 223. 
## 10 US-UMB   -84.7   45.6   234       2000     2014 DBF     FALSE 174. 
## 11 US-WCr   -90.1   45.8   520       1999     2014 DBF     FALSE 265. 
## # … with 5 more variables: koeppen_code &lt;chr&gt;, igbp_land_use &lt;chr&gt;,
## #   plant_functional_type &lt;chr&gt;, date_start &lt;date&gt;, date_end &lt;date&gt;</code></pre>
<p>Next, the data can be ingested for all sites at once. Let’s do it for different data types again.</p>
<div id="fluxnet-1" class="section level3">
<h3 class="hasAnchor">
<a href="#fluxnet-1" class="anchor"></a>FLUXNET</h3>
<div id="meteo-data-1" class="section level4">
<h4 class="hasAnchor">
<a href="#meteo-data-1" class="anchor"></a>Meteo data</h4>
<p>This ingests meteorological data from the FLUXNET files for variables temperature, precipitation, VPD, shortwave incoming radiation, net radiation, and atmospheric pressure. Arguments that are specific for this data source are provided in the <code>settings</code> list.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">ddf_fluxnet</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="kw">siteinfo</span> <span class="kw">=</span> <span class="no">siteinfo</span>,
  <span class="kw">source</span>    <span class="kw">=</span> <span class="st">"fluxnet"</span>,
  <span class="kw">getvars</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="st">"TA_F_DAY"</span>, <span class="kw">prec</span> <span class="kw">=</span> <span class="st">"P_F"</span>, <span class="kw">vpd</span>  <span class="kw">=</span> <span class="st">"VPD_F_DAY"</span>, <span class="kw">ppfd</span> <span class="kw">=</span>  <span class="st">"SW_IN_F"</span>, <span class="kw">netrad</span> <span class="kw">=</span> <span class="st">"NETRAD"</span>, <span class="kw">patm</span> <span class="kw">=</span> <span class="st">"PA_F"</span>),
  <span class="kw">dir</span>       <span class="kw">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/DD/"</span>,
  <span class="kw">settings</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">dir_hh</span> <span class="kw">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/HH/"</span>, <span class="kw">getswc</span> <span class="kw">=</span> <span class="fl">FALSE</span>),
  <span class="kw">timescale</span> <span class="kw">=</span> <span class="st">"d"</span>
  )</pre></body></html></div>
</div>
<div id="flux-data-1" class="section level4">
<h4 class="hasAnchor">
<a href="#flux-data-1" class="anchor"></a>Flux data</h4>
<p>As described above for a single site, the same function can also be used to read in other FLUXNET variables (e.g., CO2 flux data) and conduct data filtering steps. Here, we’re reading daily GPP and uncertainty (standard error), based on the nighttime flux decomposition method (<code>""GPP_NT_VUT_REF""</code>), keep only data where at least 80% is based on non-gapfilled half-hourly data (<code>threshold_GPP = 0.8</code>), and where the daytime and nighttime-based estimates are consistent, that is, where their difference is below the the 97.5% and above the 2.5% quantile (<code>filter_ntdt = TRUE</code>, see also <code>?get_obs_bysite_fluxnet2015</code>).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">settings_fluxnet</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">dir_hh</span>       <span class="kw">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/HH/"</span>,
  <span class="kw">getswc</span>       <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">filter_ntdt</span>  <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">threshold_GPP</span><span class="kw">=</span> <span class="fl">0.8</span>,
  <span class="kw">remove_neg</span>   <span class="kw">=</span> <span class="fl">FALSE</span>
  )

<span class="no">ddf_fluxnet_gpp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="kw">siteinfo</span> <span class="kw">=</span> <span class="no">siteinfo</span>,
  <span class="kw">source</span>   <span class="kw">=</span> <span class="st">"fluxnet"</span>,
  <span class="kw">getvars</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">gpp</span> <span class="kw">=</span> <span class="st">"GPP_NT_VUT_REF"</span>,
  <span class="kw">pp_unc</span>   <span class="kw">=</span> <span class="st">"GPP_NT_VUT_SE"</span>),
  <span class="kw">dir</span>      <span class="kw">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/DD/"</span>,
  <span class="kw">settings</span> <span class="kw">=</span> <span class="no">settings_fluxnet</span>,
  <span class="kw">timescale</span><span class="kw">=</span> <span class="st">"d"</span>
  )</pre></body></html></div>
</div>
</div>
<div id="watch-wfdei-1" class="section level3">
<h3 class="hasAnchor">
<a href="#watch-wfdei-1" class="anchor"></a>WATCH-WFDEI</h3>
<p>This extracts from original WATCH-WFDEI files, provided as NetCDF (global, 0.5 degree resolution), provided as monthly files containing all days in each month. The data directory specified here (<code>dir = "~/data/watch_wfdei/"</code>) contains subdirectories with names containing the variable names (corresponding to the ones specified by the argument <code>getvars = list(temp = "Tair")</code>).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">ddf_watch</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="kw">siteinfo</span> <span class="kw">=</span> <span class="no">siteinfo</span>,
  <span class="kw">source</span>    <span class="kw">=</span> <span class="st">"watch_wfdei"</span>,
  <span class="kw">getvars</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="st">"Tair"</span>),
  <span class="kw">dir</span>       <span class="kw">=</span> <span class="st">"~/data/watch_wfdei/"</span>
  )</pre></body></html></div>
</div>
<div id="cru-ts-1" class="section level3">
<h3 class="hasAnchor">
<a href="#cru-ts-1" class="anchor"></a>CRU TS</h3>
<p>This extracts monthly data from the CRU TS data. Interpolation to daily values is done using a wather generator for daily precipitation (given monthly total precipitation and number of wet days in each month), and a polynomial that conserves monthly means for all other variables.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">ddf_cru</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="kw">siteinfo</span> <span class="kw">=</span> <span class="no">siteinfo</span>,
  <span class="kw">source</span>    <span class="kw">=</span> <span class="st">"cru"</span>,
  <span class="kw">getvars</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="st">"tmx"</span>),
  <span class="kw">dir</span>       <span class="kw">=</span> <span class="st">"~/data/cru/ts_4.01/"</span>
  )</pre></body></html></div>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmx
## If that is not correct, you can set it to one of: tmx, stn</code></pre>
<p>Check it out for the first site (BE-Vie).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">ddf_fluxnet</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">date</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">temp</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">ddf_watch</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">date</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">temp</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"royalblue"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">ddf_cru</span>$<span class="no">data</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">date</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">temp</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span>(<span class="fu">ymd</span>(<span class="st">"2000-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2005-12-31"</span>))</pre></body></html></div>
<pre><code>## Warning: Removed 4745 row(s) containing missing values (geom_path).

## Warning: Removed 4745 row(s) containing missing values (geom_path).

## Warning: Removed 4745 row(s) containing missing values (geom_path).</code></pre>
<p><img src="example_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div id="google-earth-engine-1" class="section level3">
<h3 class="hasAnchor">
<a href="#google-earth-engine-1" class="anchor"></a>Google Earth Engine</h3>
<p>Using the same settings as specified above, we can download MODIS FPAR data for multiple sites at once from GEE:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">settings_gee</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_settings_gee.html">get_settings_gee</a></span>(
  <span class="kw">bundle</span>            <span class="kw">=</span> <span class="st">"modis_fpar"</span>,
  <span class="kw">python_path</span>       <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span>(<span class="st">"which python"</span>, <span class="kw">intern</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">gee_path</span>          <span class="kw">=</span> <span class="st">"~/google_earth_engine_subsets/gee_subset/"</span>,
  <span class="kw">data_path</span>         <span class="kw">=</span> <span class="st">"~/data/gee_subsets/"</span>,
  <span class="kw">method_interpol</span>   <span class="kw">=</span> <span class="st">"linear"</span>,
  <span class="kw">keep</span>              <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">overwrite_raw</span>     <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">overwrite_interpol</span><span class="kw">=</span> <span class="fl">TRUE</span>
  )

<span class="no">df_gee_modis_fpar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="kw">siteinfo</span><span class="kw">=</span> <span class="no">siteinfo</span>,
  <span class="kw">source</span>  <span class="kw">=</span> <span class="st">"gee"</span>,
  <span class="kw">settings</span><span class="kw">=</span> <span class="no">settings_gee</span>,
  <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  )</pre></body></html></div>
<p>Collect all plots.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">list_gg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plot_fapar_ingestr.html">plot_fapar_ingestr</a></span>(<span class="no">df_gee_modis_fpar</span>, <span class="no">settings_gee</span>)
<span class="co">#purrr::map(list_gg, ~print(.))</span></pre></body></html></div>
</div>
<div id="co2-1" class="section level3">
<h3 class="hasAnchor">
<a href="#co2-1" class="anchor"></a>CO2</h3>
<p>Ingesting CO2 data is particularly simple. We can safely assume it’s well mixed in the atmosphere (independent of site location), and we can use a annual mean value for all days in respective years.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_co2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="no">siteinfo</span>,
  <span class="kw">source</span>  <span class="kw">=</span> <span class="st">"co2"</span>,
  <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">settings</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">path</span> <span class="kw">=</span> <span class="st">"~/data/co2/cCO2_rcp85_const850-1765.csv"</span>)
  )</pre></body></html></div>
</div>
<div id="etopo1" class="section level3">
<h3 class="hasAnchor">
<a href="#etopo1" class="anchor"></a>ETOPO1</h3>
<p>This reads from the 1 arc minutes resolution ETOPO1 global elevation data (reading from a Geo-TIFF file).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_etopo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="no">siteinfo</span>,
  <span class="kw">source</span> <span class="kw">=</span> <span class="st">"etopo1"</span>,
  <span class="kw">dir</span> <span class="kw">=</span> <span class="st">"~/data/etopo/"</span>
)</pre></body></html></div>
<!-- xxxxxxx -->
<!-- ### rsofun input data -->
<!-- First read all FLUXNET meteo data. -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- ddf_fluxnet <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "fluxnet", -->
<!--   getvars   = list(temp = "TA_F_DAY", prec = "P_F", vpd  = "VPD_F_DAY", ppfd =  "SW_IN_F", netrad = "NETRAD", patm = "PA_F"), -->
<!--   dir       = "~/data/FLUXNET-2015_Tier1/20191024/DD/", -->
<!--   settings  = list(dir_hh = "~/data/FLUXNET-2015_Tier1/20191024/HH/", getswc = FALSE, threshold_GPP = 0.5), -->
<!--   timescale = "d" -->
<!--   ) -->
<!-- ``` -->
<!-- Some meteo data is not available from FLUXNET. Extract it from WATCH-WFDEI global climate reanalysis files instead. -->
<!-- ```{r} -->
<!-- ddf_watch <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "watch_wfdei", -->
<!--   getvars   = list(temp = "Tair"), -->
<!--   dir       = "~/data/watch_wfdei/" -->
<!--   ) -->
<!-- ``` -->
<!-- Some meteo data is not available from FLUXNET. Extract it from CRU global climate files instead. -->
<!-- ```{r} -->
<!-- ddf_cru <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "cru", -->
<!--   getvars   = list(ccov = "cld"), -->
<!--   dir       = "~/data/cru/ts_4.01/" -->
<!--   ) -->
<!-- ``` -->
<!-- ### Evaluation data -->
<!-- ### Calibration data -->
<!-- tbc -->
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Benjamin Stocker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
